!function(e){"use strict";define(["jquery","lodash","cssmap","settings","modules.form.validation","modules.modalBox","modules.assign","bootstrap.collapse"],function(t,a,n,i,r,s,l){function d(e){var a=t(e.currentTarget),i=t(a.data("required"));a.is(I)?t(I+'[name="'+a.attr("name")+'"]').each(function(){var e=t(this),a=t(e.data("required"));a.required(e.isDifferent())}):i.is("input, textarea, select, button")&&i.closest(n(".","bsCollapse",".","bsIn"))?i.required(!0).trigger("init"):i.required(a.isDifferent()).trigger("init")}function c(e){var a=t(e.currentTarget),n=t(a.data("single-required")),i=a.add(n);i.isEmpty()?(i.required(!0),"change"===e.type&&n.trigger("validate")):n.isEmpty()?(n.required(!1),n.trigger("init")):a.isEmpty()&&(a.required(!1),n.required(!0))}function o(e){var a=t(e.currentTarget),i=t(a.data("single-enabled"));a.val().length>0?i.not(a).prop("disabled",!0).addClass(n("disabled")):i.add(a).prop("disabled",!1).removeClass(n("disabled"))}function u(e){var a=t(e.currentTarget),i=a.data("blurfx"),r=a.data("blurfx-ignore"),s=a.closest(i);s.length||(s=t(i)),s.find(n(".","layerOverlay")).not(r).fadeToggle()}function f(e){var a=t(e.currentTarget),i=t(a.data("extra")),r=a.isDifferent(),s=i.find("input:not([type=radio]), input[type=radio]:checked, select, textarea, button");if(a.is(I)){var l=a.closest(n(".","active")),d=t(a.data("extra")),c=a.data("showHidden");l&&c===!0&&d.collapse("show"),t(I+'[name="'+a.attr("name")+'"]').each(function(e){var a=t(this),i=t(a.data("extra")),r=i.parent().siblings().not(n(".","active"));r&&c===!0&&r.find(".in").collapse("hide"),i.each(function(){var e=t(this);e.hasClass("in")})})}else r?(i.hasClass("in")||a.prop("checked",!0).next().addClass("select"),i.collapse("show"),i.find("textarea").trigger("keyup")):i.hasClass("in")?i.hasClass("in")&&i.collapse("hide"):a.prop("checked")===!0&&(i.collapse("show"),i.find("textarea").trigger("keyup"));if(r&&i.length>0){if(i.hasClass("fnb_message_container")){var o=i.find("[data-text-type='fnb_gift_message']");o.length&&0==o.val().length&&i.find(n(".","error")).removeClass(n("error")),i.collapse("hide")}s.trigger("init")}}function p(e){var a=t(e.currentTarget),n=t(a.data("sync-checkbox")),i=a.isDifferent();a.is(V)&&(i=a.prop("checked")),n.each(function(){var e=t(this),a=e.prop("checked");a!==i&&e.prop("checked",i).trigger("change")})}function g(e){var a=t(e.currentTarget),n=t(a.data("reset-target")),i=a.data("reset")||"";":reset"===i?n.resetOriginalValue():n.is(V)?n.prop("checked",":checked"===i).trigger("change"):n.val(i)}function h(e){var a=t(e.target),n=a.is("[data-toggle-target]")?t(a.data("toggle-target")):a.closest("form"),i=n.find("input").is("[disabled]");require(["jquery.formfocus"],function(){n.fnbFormFocus(i)})}function m(e){var a=t(e.target).closest("form");a.find("input, select, textarea").resetOriginalValue(),a.find(t(n(".","form_field"))).removeClass(n("fnb_error")),a.trigger("fnb.form.reset")}function b(e){e?t(n(".","transSelect"),n(".","shippingMode")).addClass(n("disabled")).find("input").prop("disabled",!0):t(n(".","transSelect"),n(".","shippingMode")).removeClass(n("disabled")).find("input").prop("disabled",!1)}function v(){var e=t(this);e.addClass(n("active")),e.find("input").prop("required",!0).removeAttr("disabled"),e.siblings(n(".","address")).removeClass(n("active")).find("input").prop("required",!0).removeAttr("disabled"),k(!0)}function x(e){e.preventDefault(),t(n(".","btnNewAddress")).slideUp(),t(this).hasClass(n("collapsed"))?(t(t(n(".","address"))[0]).addClass(n("active")).find("input").prop("checked",!0).next().addClass("select"),t(n(".","address")).find("input").removeAttr("disabled").prop("required",!0),b(!1)):(t(n(".","address",".","active")).removeClass(n("active")).find("input").removeAttr("checked").next().removeClass("select"),t(n(".","address")).find("input").prop("required",!1).prop("disabled",!0),b(!0))}function k(e){1!=e&&t(t(n(".","address"))[0]).addClass(n("active")).find("input").prop({required:!0,checked:!0}).removeAttr("disabled").next().addClass("select"),t(n(".","btnNewAddress")).slideDown(),t(n("#","addNewAddress")).collapse("hide"),t(".fnb_block_fact_address").length>0&&t(".fnb_block_fact_address .fnb_checkbox span").addClass("select"),b(!1)}function w(){var e=t(n("#","useWallet"));t(this).hasClass(n("collapsed"))?(t(n(".","fnbBtnNewMode")).slideDown(),t(t(n(".","fnbLabelModePayement"))[0]).addClass(n("active")).find("input").prop("checked",!0).next().addClass("select"),t(n(".","address")).find("input").prop("required",!0),e.length&&e.val("true")):(t(n(".","fnbBtnNewMode")).slideUp(),t(n(".","fnbLabelModePayement")).removeClass(n("active")).find("input").removeAttr("checked").next().removeClass("select"),t(n(".","fnbLabelModePayement")).find("input").prop("required",!1),e.length&&e.val("false"))}function C(){var e=t(n("#","useWallet"));e.length&&1!=e.val()&&e.val("true"),t(n(".","fnbLabelModePayement")).each(function(){t(this).find("input").prop("checked")?t(this).addClass(n("active")):t(this).removeClass(n("active"))}),t(this).addClass(n("active")),t(this).siblings(n(".","fnbLabelModePayement")).removeClass(n("active")),t(n(".","fnbBtnNewMode"," a")).addClass(n("collapsed")),t(t(n(".","fnbBtnNewMode"," a")).attr("data-target")).removeClass(n("bsIn")),t(n(".","fnbBtnNewMode")).slideDown()}function y(e){t(e.currentTarget).closest("form").trigger("submit")}function E(e){if("submit"===e.type&&!r.validateSubmit(e))return!1;var s=t(e.target),l=s.find("button[type=submit]");l.prop("disabled",!0).addClass(n("disabled")),a.delay(function(){l.not(".toBeDisabled").prop("disabled",!1).removeClass(n("disabled"))},i.forms.lockTimeout)}function q(e,a){var n,i=t(a.currentTarget),r=i.data("duplicate")||i.data("clean-duplicate");r="previous"===r?i.prev():"next"===r?i.next():"self"===r?i:t(r),n=r.clone(),n.find("[id]").each(function(e){var a=t(this),i=a.attr("id");a.attr("id",i+"_"+e),t("[for="+i+"]",n).attr("for",i+"_"+e)}),e&&n.find("input, textarea, select").resetOriginalValue(),n.insertAfter(r)}function _(e){var a=t(e.currentTarget),i=a.data("maxsamples"),r=a.find(V);if(r.not(":checked").prop("disabled",r.filter(":checked").length===i).trigger("disable"),r.filter(":checked").length===i){var s=t(n("#","cartErrorMsg")).first();s.length&&s.hide()}}function T(e){W.limitTextareaChar(e)}function A(e,t){return e.replace(new RegExp(t.autolinebreak,"g"),"").replace(/\r|\n/g,"").length}function D(e,t){if(e.length>t.maxchar){var a=t.maxchar,n=e.slice(0,a);return-1!==n.lastIndexOf(" ")&&t.numlines+1<t.maxlines&&(a=n.lastIndexOf(" ")+1),M(e.slice(0,a),t),e=e.slice(a),D(e,t)}return e}function M(e,t){if(t.numlines>=t.maxlines)return void(t.exceed=!0);if(t.numlines++,"zh_CN"===i.language)var a=1===t.numlines?"":(N(t.newText,"\n"),"");else var a=1===t.numlines?"":N(t.newText,"\n")?"":t.autolinebreak;t.cursor>t.newText.length&&a.length&&(t.cursor+=a.length),t.newText+=a+e}function N(e,t){return-1!==e.indexOf(t,e.length-t.length)}function P(e){var a=t(e.currentTarget),n=t(a.data("select-filter")),i=a.val(),r=n.data("list-of-options");r||(r=n.find("option").clone(),n.data("list-of-options",r)),n.empty().append(r.filter('[data-filter="'+i+'"]').clone()).trigger("change"===e.type?"change":"initialized")}function B(e){var a=t(n(".","recaptcha"),e);a.length&&(t(n(".","recaptcha")).length>1||require(["recaptcha"],function(e){e.create(i.forms.recaptcha.public_key,a.attr("id"),{theme:"custom",lang:i.language,callback:function(){a.trigger("shown")}})}))}function L(e){0===e.length||"placeholder"in document.createElement("input")||require(["plugins.jquery.placeholder"],function(){e.placeholder()})}function O(){var e=t("#formBag"),r=t("*[data-maxsamples]"),l=r.data("maxsamples"),d=r.find(V);if(0!==e.length){j=!0;var c,o=!1;t(document).on("fnb.modal.initialized",a.debounce(function(){if(c=t(".fnb_popin-sample"),c.length>0){var a=t(n(".","modal"));a.data("bs.modal").options.backdrop="static";var i=e.find(".fnb_bag_sample .fnb_checkbox span.select");i.length>0&&i.each(function(){var e=t(this).parents("label").attr("for");c.find("#"+e+"b").trigger("click")}),c.on("change","input[type=checkbox]",function(){t("#"+this.id.slice(0,-1)).trigger("click")}),c.on("click","button[type=button]",function(){o=!0,e.trigger("submit"),s.close()})}},50)),t(n(".","modal")).on("hidden.bs.modal",function(){c=t(".fnb_popin-sample"),c.length>0&&(o=!1,t(this).data("bs.modal").options.backdrop=!0,t(".fnb_popin-sample").off("change"),e.find("button[type=submit]").not(".toBeDisabled").prop("disabled",!1).removeClass(n("disabled")))}),e.on("submit",function(e){if(!o&&d.filter(":checked").length!==l){e.preventDefault();var t={url:i.hybris.URL.samplePopin},a={mClass:"fnb_col-wd10"};s.openRemote(t,a)}})}}function R(){t(n(".","btnEditEmail")).slideUp(),t(n(".","btnEditPwd")).slideUp()}function S(){t(n(".","btnEditEmail")).find("a").hide(),t(n(".","btnEditPwd")).slideUp()}function F(e){t(n(".","btnEditEmail")).slideDown(),t(n(".","btnEditPwd")).slideDown(),t(n(".","btnEditEmail")).find("a").show().removeClass("hide"),t(n(".","fnb_btn_edit_pwd")).removeClass("hide"),e?t(n("#","emailEdit")).collapse("hide"):t(n(".","btnEditEmail")).find("a").show(),t(n("#","pwdEdit")).collapse("hide")}function U(t){var a={addLine:M,numChars:A,breakLine:D,endsWith:N,toggleShippingForm:b};l.exec(W,"eventsForm",e,a),x=l.exec(x,"newAddress",e,a),v=l.exec(v,"addressSelect",e,a),k=l.exec(k,"cancelNewAddress",e,a),l.boot()}function z(a){j||(U(),t("input, textarea, select, button",a).each(function(){var a=t(this);a.data("original-value")===e&&(a.is(V)||a.is(I)?a.data("original-value",a.is(":checked")):a.data("original-value",a.val()))}),z.events(),t("[data-required]").trigger("init"),t("[data-single-required]").trigger("init"),t("[data-single-enabled]").trigger("init"),t("[data-maxsamples]").trigger("change"),t("[data-select-filter]").trigger("init"),t("[data-extra]").each(function(){var e=t(this);e.isDifferent()&&e.trigger("init")}),t(n(".","fnb_address")).each(function(){t(this).find("input").prop("checked")?t(this).addClass(n("active")):t(this).removeClass(n("active"))}),t("[disabled]:not("+n(".","disabled",", .","off")+")").removeAttr("disabled"),B(a),L(t("input[placeholder]")))}var I="[type=radio]",V="[type=checkbox]",j=!1,W={limitTextareaChar:function(e){var i="â€‹",r=t(e.currentTarget),s=r.find("textarea"),l={autolinebreak:i+"\n",maxchar:r.data("maxchar"),maxlines:r.data("maxlines")||1,newText:"",numlines:0,exceed:!1,cursor:s[0].selectionStart},d=s.val().replace(/\r/g,"").replace(new RegExp(l.autolinebreak,"g"),"").replace(new RegExp(i,"g"),""),c=d.split("\n"),o={chars:r.find(n(".","charsLeft")),lines:r.find(n(".","linesLeft"))};l.max=l.maxchar*l.maxlines;var u=s.val().substring(0,l.cursor),f=2*(u.match(new RegExp(l.autolinebreak,"g"))||[]).length+(u.replace(new RegExp(l.autolinebreak,"g"),"").match(new RegExp(i,"g"))||[]).length;return f&&(l.cursor-=f),s.data("oldval")===s.val()?void l.numlines++:(a.each(c,function(e){for(l.numlines>0&&l.numlines<l.maxlines&&(l.newText+="\n");e.length>l.maxchar;)e=D(e,l);M(e,l)}),o.chars.toggleClass(n("wrong"),A(d,l)>l.max).html(l.max-A(l.newText,l)),o.lines.toggleClass(n("wrong"),l.numlines>l.maxlines).html(l.maxlines-l.numlines),s.val(l.newText),s.data("oldval",l.newText),s[0].selectionStart=s[0].selectionEnd=l.cursor,s.toggleClass(n("error"),l.exceed),void r.find(n(".","charsExceed")).toggleClass(n("error"),l.exceed))}};return t.fn.required=function(e){return this.each(function(){var a=t(this);a.is("input, textarea, select, button")&&a.prop("required",e).attr("aria-required",e).closest(n(".","formField")).find(n(".","mandatory")).toggleClass(n("bsHide"),!e)})},t.fn.isDifferent=function(){var e=!1;return this.each(function(){var a=t(this);if(a.is(V)||a.is(I)){if(a.is(":checked")!==a.data("original-value"))return e=!0,!1}else if(a.data("original-value")!==a.val())return e=!0,!1}),e},t.fn.resetOriginalValue=function(e){return this.each(function(){var a=t(this);return a.isDifferent()?void(a.is(V)||a.is(I)?a.prop("checked",a.data("original-value")).trigger("change",e):(a.val(a.data("original-value")),a.is("select")&&a.trigger("change",e))):this}),this},t.fn.serializeData=function(){var e=t(this),a={};return t.each(e.serializeArray(),function(e,n){a.hasOwnProperty(n.name)?(a[n.name]=t.makeArray(a[n.name]),a[n.name].push(n.value)):a[n.name]=n.value}),a},t.fn.isEmpty=function(){var e=!0;return this.each(function(){var a=t(this);return e=a.is(V)||a.is(I)?!a.is(":checked"):0===String(a.val()).length,e?void 0:!1}),e},z.events=a.once(function(){t(document).on("change",n("form .","submit"),y).on("submit","form",E).on("change","[data-sync-checkbox]",p).on("change","[data-maxsamples]",_).on("change","[data-reset-target]",g).on("change init","[data-extra]",f).on("change init","[data-select-filter]",P).on("change keyup init","[data-required]",d).on("change keyup init","[data-single-required]",c).on("change keyup init","[data-single-enabled]",o).on("keyup init","[data-maxchar]",T).on("click","[data-duplicate]",a.partial(q,!1)).on("click","[data-clean-duplicate]",a.partial(q,!0)).on("click","[data-blurfx]",u).on("click",n(".","toggleForm"),h).on("click",n(".","resetForm"),m).on("click",n(".","address"),v).on("click",n(".","cancelNewAddress"),k).on("click",n(".","btnNewAddress"," a"),x).on("click",n(".","fnbLabelModePayement"),C).on("click",n(".","fnbBtnNewMode"," a"),w).on("click",n(".","btnEditEmail"," a"),R).on("click",n(".","cancelEditEmail"),a.partial(F,!0)).on("click",n(".","btnEditPwd"," a"),S).on("click",n(".","cancelEditPwd"),a.partial(F,!1)),O()}),{init:z,disableBtn:E}})}();